version: 1
frontend:
  phases:
    build:
      commands:
        - echo "No frontend build commands needed"
  artifacts:
    baseDirectory: .
    files:
      - '**/*'
  cache:
    paths: []
backend:
  phases:
    preBuild:
      commands:
        - curl -OL https://golang.org/dl/go1.22.0.linux-amd64.tar.gz
        - sudo rm -rf /usr/local/go
        - sudo tar -C /usr/local -xzf go1.22.0.linux-amd64.tar.gz
        - export PATH=$PATH:/usr/local/go/bin
        - export GOPATH=$HOME/go
        - export GOMODCACHE=$HOME/go/pkg/mod
        - mkdir -p $HOME/go/pkg/mod
        - go version
    build:
      commands:
        - echo "Setting up directories..."
        - mkdir -p templates static
        - echo "Verifying directory structure..."
        - ls -la templates/
        - ls -la static/
        - echo "Downloading dependencies..."
        - go mod download
        - echo "Building application..."
        - chmod +x build.sh
        - ./build.sh
        - echo "Verifying final build state..."
        - ls -la
        - echo "Verifying template files..."
        - ls -la templates/
        - echo "Content of index.html:"
        - cat templates/index.html | head -n 5
        - echo "Content of speaker.html:"
        - cat templates/speaker.html | head -n 5
        - echo "Content of audience.html:"
        - cat templates/audience.html | head -n 5
  artifacts:
    baseDirectory: .
    files:
      - '**/*'
      - templates/**/*
      - static/**/*
      - main
      - '!node_modules/**'
      - '!amplify/**'
      - '!build/**'
  cache:
    paths:
      - go.sum
      - go.mod 